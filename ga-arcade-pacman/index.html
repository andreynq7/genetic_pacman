﻿﻿﻿﻿﻿<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GA-Arcade · Pac-Man</title>
  <link rel="stylesheet" href="./src/css/styles.css">
</head>
<body>
  <header class="app-header">
    <div class="title-group">
      <h1>GA-Arcade · Pac-Man</h1>
      <p class="subtitle">Algoritmo Genético + Juego Clásico 2D</p>
    </div>
    <div class="status-block">
      <span class="status-label">Estado</span>
      <span id="status-badge" class="status-badge status-idle">Idle</span>
    </div>
  </header>

  <main class="layout">
    <section class="panel panel-left">
      <div class="panel-header">
        <h2>Parámetros del AG</h2>
        <p class="panel-hint">Configura población, tasas y simulación antes de iniciar.</p>
      </div>
      <form id="ga-params-form" class="params-form" novalidate>
        <div class="form-group">
          <label for="population-input">Tamaño de población (N)</label>
          <input type="number" id="population-input" name="population" min="1" step="1" placeholder="Ej. 40">
        </div>
        <div class="form-group">
          <label for="generations-input">Generaciones (G)</label>
          <input type="number" id="generations-input" name="generations" min="1" step="1" placeholder="Ej. 50">
        </div>
        <div class="form-group">
          <label for="selection-input">% Selección</label>
          <input type="number" id="selection-input" name="selection" min="0" max="100" step="1" placeholder="Ej. 40">
        </div>
        <div class="form-group">
          <label for="crossover-input">% Cruzamiento</label>
          <input type="number" id="crossover-input" name="crossover" min="0" max="100" step="1" placeholder="Ej. 45">
        </div>
        <div class="form-group">
          <label for="mutation-input">% Mutación</label>
          <input type="number" id="mutation-input" name="mutation" min="0" max="100" step="1" placeholder="Ej. 15">
        </div>
        <div class="form-group">
          <label for="tournament-input">Tamaño de torneo</label>
          <input type="number" id="tournament-input" name="tournament" min="1" step="1" placeholder="Ej. 3">
        </div>
        <div class="form-group">
          <label for="seed-input">Semilla aleatoria</label>
          <input type="number" id="seed-input" name="seed" step="1" placeholder="Ej. 42">
        </div>
        <div class="form-group">
          <label for="episodes-input">Episodios por individuo</label>
          <input type="number" id="episodes-input" name="episodes" min="1" step="1" placeholder="Ej. 3">
        </div>


        <div id="percentage-error" class="error-message hidden">La suma de porcentajes debe ser 100%.</div>
      </form>
    </section>

    <section class="panel panel-center">
      <div class="panel-header">
        <h2>Área de juego</h2>
      </div>
      <div class="game-area">
        <canvas id="game-canvas" width="448" height="496"></canvas>
        <div class="game-status-bar">
          <div class="status-item">
            <span class="label">Puntaje</span>
            <span id="score-value" class="value">0</span>
          </div>
          <div class="status-item">
            <span class="label">Nivel</span>
            <span id="level-value" class="value">1</span>
          </div>
          <div class="status-item">
            <span class="label">Vidas</span>
            <span id="lives-value" class="value">3</span>
          </div>
        </div>
      </div>
    </section>

    <section class="panel panel-right">
      <div class="panel-section-group">
        <div class="panel-section">
          <h2>Controles</h2>
          <div class="controls-grid">
            <button type="button" id="start-btn" class="btn primary">Start</button>
            <button type="button" id="pause-btn" class="btn">Pause</button>
            <button type="button" id="extend-btn" class="btn">Extender GA</button>
            <button type="button" id="reset-btn" class="btn">Reset</button>
            <button type="button" id="demo-btn" class="btn ghost">Demo best</button>
            <button type="button" id="export-best-btn" class="btn">Export Best</button>
            <button type="button" id="export-run-btn" class="btn">Export Run Data</button>
            <button type="button" id="export-fitness-btn" class="btn">Export Fitness History</button>
          </div>
        </div>

        <div class="panel-section">
          <h2>Métricas en vivo</h2>
          <div class="metrics-grid">
            <div class="metric-card">
              <span class="metric-label">Mejor fitness</span>
              <span id="best-fitness" class="metric-value">--</span>
            </div>
            <div class="metric-card">
              <span class="metric-label">Fitness promedio</span>
              <span id="avg-fitness" class="metric-value">--</span>
            </div>
            <div class="metric-card">
              <span class="metric-label">Tiempo total</span>
              <span id="total-time" class="metric-value">--</span>
            </div>
            <div class="metric-card">
              <span class="metric-label">Tiempo promedio/gen</span>
              <span id="avg-time" class="metric-value">--</span>
            </div>
            <div class="metric-card">
              <span class="metric-label">Generación</span>
              <span id="generation-count" class="metric-value">--</span>
            </div>

          </div>
          <div class="metrics-graph">
            <div class="graph-header">
              <span>Fitness (Mejor vs Promedio)</span>
              <span class="graph-note">Evolución del entrenamiento</span>
            </div>
            <canvas id="metrics-canvas" width="360" height="180"></canvas>

          </div>
        </div>

        <div class="panel-section">
          <h2>Distribución de población</h2>
          <p class="panel-hint">Evolución por generación con foco en mejoras.</p>
          <div class="pop-chart-controls">
            <div class="control-group toggles">
              <button type="button" id="pop-improvement-btn" class="btn ghost small" aria-pressed="false">Vista de mejoras</button>
              <button type="button" id="pop-cumulative-btn" class="btn small" aria-pressed="false">Datos acumulados</button>
            </div>
            <div class="control-group">
              <label for="population-range-start">Rango de generaciones</label>
              <div class="range-inputs">
                <input type="number" id="population-range-start" min="0" value="0" aria-label="Generación inicial">
                <input type="number" id="population-range-end" min="0" value="0" aria-label="Generación final">
              </div>
            </div>
          </div>
          <div class="pop-chart-legend" aria-hidden="true">
            <span class="legend-item"><span class="swatch swatch-improving"></span>Mejoran</span>
            <span class="legend-item"><span class="swatch swatch-stable"></span>Estables</span>
            <span class="legend-item"><span class="swatch swatch-regress"></span>Retroceden</span>
            <span class="legend-item line"><span class="swatch-line"></span>Tendencia</span>
          </div>
          <p class="panel-hint">Metodología: se compara cada individuo contra el promedio previo (±2% es estable, >2% mejora, <-2% retrocede). El modo acumulado suma las categorías a lo largo del tiempo.</p>
          <div class="pop-chart-wrapper">
            <svg id="population-chart" role="img" aria-label="Distribución de población por generación" focusable="false"></svg>
            <div id="population-tooltip" class="chart-tooltip hidden" role="status" aria-live="polite"></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="app-footer">
    <span>Proyecto GA-Arcade · Pac-Man · Análisis de Algoritmos</span>
    <span class="version">UI stub v0.1</span>
  </footer>

  <script src="./src/config/defaultConfig.js"></script>
  <script src="./src/js/utils/logger.js"></script>
  <script src="./src/js/utils/bestStore.js"></script>
  <script src="./src/config/configLoader.js"></script>
<script src="./src/js/utils/domHelpers.js"></script>
<script src="./src/js/ui/uiLayout.js"></script>
<script src="./src/js/ui/uiForms.js"></script>
<script src="./src/js/input/uiControls.js"></script>
<script src="./src/js/ui/uiMetrics.js"></script>
<script src="./src/js/ui/populationChart.js"></script>

<script src="./src/js/render/gameView.js"></script>
<script src="./src/js/game/gameConstants.js"></script>
<script src="./src/js/game/gameState.js"></script>
<script src="./src/js/game/gameLogic.js"></script>
<script src="./src/js/game/episodeSimulator.js"></script>
<script src="./src/js/game/audioManager.js"></script>
<script src="./src/js/agent/policyEncoding.js"></script>
<script src="./src/js/ga/fitnessEvaluator.js"></script>
<script src="./src/js/ga/geneticAlgorithm.js"></script>
<script src="./src/js/ga/workerMessages.js"></script>
<script src="./src/js/ga/workerPool.js"></script>
<script src="./src/js/ga/gaController.js"></script>

<script src="./src/js/main.js"></script>

</body>
</html>
